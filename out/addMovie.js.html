<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: addMovie.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: addMovie.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const models = require('../../models');
const { successResponse, errorResponse } = require('../response/response')
/** @description This function adds the Movie to the database 
 * @param {object} req - Request object with movieName,actor,actress,director,producer,releaseYear,rating,imgUrl
 * @param {object} res -  Reponse object with success message if success or error message if there is an error.
 *  @returns {Promise}
*/
const addMovie = async (req, res, next) => {
    try {

        const movie = {
            movieName: req.body.movieName,
            releaseYear: req.body.releaseYear,
            rating: req.body.rating,
            imgURL: ''

        }
        const act = await models.Movie.create(movie)

        actorArray = req.body.actor
        actorArray.map(async (item, key) => {
            const actordetails = await models.Person.findOne({
                where: {
                    name: actorArray[key]
                }
            })
            if (!actordetails) {
                const person = {
                    name: actorArray[key],
                    // roleId:1,
                    // movieId:moviedetails.id
                }
                const actor = await models.Person.create(person)
                const movieperson = {
                    movieId: act.id,
                    personId: actor.id
                }
                const moviepersona = await models.MoviePerson.create(movieperson)
                const moviepersonroledata = {
                    roleId: 1,
                    moviePersonId: moviepersona.id
                }
                const moviepersonroleactor = await models.MoviePersonRole.create(moviepersonroledata)
            }
            else {
                const movieperson = {
                    movieId: act.id,
                    personId: actordetails.id
                }
                const moviepersona = await models.MoviePerson.create(movieperson)
                const moviepersonroledata = {
                    roleId: 1,
                    moviePersonId: moviepersona.id
                }
                const moviepersonroleactor = await models.MoviePersonRole.create(moviepersonroledata)
            }
        })
        actressArray = req.body.actress
        actressArray.map(async (item, key) => {
            const actressdetails = await models.Person.findOne({
                where: {
                    name: actressArray[key]
                }
            })
            if (!actressdetails) {
                const person = {
                    name: actressArray[key]
                }
                const actress = await models.Person.create(person)
                const movieperson = {
                    movieId: act.id,
                    personId: actress.id
                }
                const moviepersonact = await models.MoviePerson.create(movieperson)
                const moviepersonroledata = {
                    roleId: 2,
                    moviePersonId: moviepersonact.id
                }
                const moviepersonroleactress = await models.MoviePersonRole.create(moviepersonroledata)
            }
            else {
                const movieperson = {
                    movieId: act.id,
                    personId: actressdetails.id
                }
                const moviepersonact = await models.MoviePerson.create(movieperson)
                const moviepersonroledata = {
                    roleId: 2,
                    moviePersonId: moviepersonact.id
                }
                const moviepersonroleactor = await models.MoviePersonRole.create(moviepersonroledata)
            }
        })
        const directordetails = await models.Person.findOne({
            where: {
                name: req.body.director
            }
        })
        if (!directordetails) {
            const person = {
                name: req.body.director,

            }
            const director = await models.Person.create(person)
            const movieperson = {
                movieId: act.id,
                personId: director.id
            }
            const moviepersondir = await models.MoviePerson.create(movieperson)
            const moviepersonroledata = {
                roleId: 3,
                moviePersonId: moviepersondir.id
            }
            const moviepersonroledirector = await models.MoviePersonRole.create(moviepersonroledata)

        }
        else {
            const movieperson = {
                movieId: act.id,
                personId: directordetails.id
            }
            const moviepersondir = await models.MoviePerson.create(movieperson)
            const moviepersonroledata = {
                roleId: 3,
                moviePersonId: moviepersondir.id
            }
            const moviepersonroleactor = await models.MoviePersonRole.create(moviepersonroledata)
        }
        const producerdetails = await models.Person.findOne({
            where: {
                name: req.body.producer
            }
        })
        if (!producerdetails) {
            const person = {
                name: req.body.producer,

            }
            const producer = await models.Person.create(person)
            const movieperson = {
                movieId: act.id,
                personId: producer.id
            }
            const moviepersonpro = await models.MoviePerson.create(movieperson)
            const moviepersonroledata = {
                roleId: 4,
                moviePersonId: moviepersonpro.id
            }
            const moviepersonroleproduer = await models.MoviePersonRole.create(moviepersonroledata)

        }
        else {
            const movieperson = {
                movieId: act.id,
                personId: producerdetails.id
            }
            const moviepersonpro = await models.MoviePerson.create(movieperson)
            const moviepersonroledata = {
                roleId: 4,
                moviePersonId: moviepersonpro.id
            }
            const moviepersonroleactor = await models.MoviePersonRole.create(moviepersonroledata)
        }
        result = successResponse(res)
        result
        logger.info("Movie added successfully")

    }
    catch (error) {
        result = errorResponse(error, res)
        result
        logger.error("Error! Unable to add movies")
        next(error)
    }
}
module.exports = addMovie;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addMovie">addMovie</a></li><li><a href="global.html#deleteMovie">deleteMovie</a></li><li><a href="global.html#editMovie">editMovie</a></li><li><a href="global.html#getMovie">getMovie</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Mon May 04 2020 17:13:38 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
